
library(plyr)
library(here)
library(dbplyr)
library(tidyverse)
library(sf)
library(aws.s3)
library(data.table)
library(magrittr)


tgo_osm_tab_clean <- read.csv(here::here("data","temp","tgo_osm_tab_clean.csv"))

#looking for parks, transit centers, grocery stores, market areas, post offices, city halls, religious sites, & community centers
keyword_vec <- c("place of worship", "pharmacy", "marketplace", "church", "community centre",
                "fountain", "bus station", "supermarket", "mosque", "post office",
                "bicycle repair station", "library", "food court", "attraction", "townhall",
                "religion", "ferry terminal", "chapel", "social facility", "government",
                "mall", "temple", "bicycle parking", "transportation", "cathedral",
                "fire station", "picnic site", "social centre", "train station", "Church",
                "grocery", "shopping centre", "clinic", "higher education", "hospital",
                "medical other", "music school", "primary/secondary", "zoo") 
  
tgo_osm_tab_clean$building  <- as.vector(tgo_osm_tab_clean$building)

raw_tag_count <- plyr::count(tgo_osm_tab_clean$building)  #counts the frequency of each tag

colnames(raw_tag_count) <- c("building", "freq")

clean_tag_count <- raw_tag_count %>% filter(building %in% keyword_vec) #selects the rows that exist within the keyword vector

write.csv(clean_tag_count, here::here("data","clean_tag_count.csv")) #rewrites if the keyword vec has been changed

# clean_tag_count <- read_csv("data/clean_tag_count.csv") #if reading them from a file
# keyword_vec <- as.vector(clean_tag_count$building)
# colnames(clean_tag_count) <- c("building", "freq")


tgo_osm_tab_clean_selected_keys <- tgo_osm_tab_clean[tgo_osm_tab_clean$building %in% keyword_vec,] #out of all the buildings pick the ones that have matching tags

rm(raw_tag_count, clean_tag_count,tgo_osm_tab_clean, keyword_vec) #clean up environment

osm_geojson <- st_read(here::here("data","tgo_osm_geo.geojson"))
osm_geojson %>% dplyr::distinct(id)

selected_buildings <- dplyr::inner_join(osm_geojson, tgo_osm_tab_clean_selected_keys)



  


